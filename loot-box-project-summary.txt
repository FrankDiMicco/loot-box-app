================================================================================
                    LOOT BOX CREATOR - PROJECT SUMMARY
================================================================================

PROJECT OVERVIEW
--------------------------------------------------------------------------------
A mobile-ready loot box creation and opening app with deep space royal blue
aesthetic and Firebase backend. Users can create custom loot boxes with
configurable items, percentages, and opening mechanics. Features a marketplace
for seasonal and purchasable box skins. Built with React (via CDN) in a single
HTML file with Firebase integration for scalability.

CURRENT STATUS: Fully functional with Firebase integration! Local boxes work
offline, seasonal/store boxes load from Firebase. Ready for mobile deployment.

PLATFORM: Designed for mobile app deployment (web-based, Firebase backend)


================================================================================
COMPLETED FEATURES
================================================================================

CORE FUNCTIONALITY
--------------------------------------------------------------------------------
âœ“ Create Boxes
  - Box name input
  - Type selection (local/shared)
  - Box image selector with marketplace tabs
  - Max pulls limit (optional)
  - Hide contents option (shows "???" for items, "Mystery Item" for other users)
  - Hide odds option (completely hides odds panel)

âœ“ Add Items to Boxes
  - Item name
  - Percentage (must total exactly 100%)
  - Color picker (8 predefined colors)
  - Max quantity (optional, enables dynamic odds)
  - Real-time percentage validation with remaining % display

âœ“ Edit Boxes
  - Full editing of existing boxes
  - Modify box name, settings, items, box image
  - Pre-fills all data in edit mode
  - Can add/remove/edit items

âœ“ Edit Items
  - Click edit button on any item
  - Pre-fills form with item data
  - Update button replaces add button
  - Cancel option to exit edit mode

âœ“ Delete Boxes
  - Custom modal confirmation dialog (no browser popups)
  - Shows box name in confirmation
  - Properly clears state if viewing deleted box
  - Success toast notification

âœ“ Open Boxes
  - 2-second spinning box animation
  - Beautiful reveal with item color glow
  - Shows item name and percentage
  - Can open multiple times (if pulls remaining)
  - Name entry prompt for shared boxes

âœ“ Dynamic Odds System
  - Automatically adjusts percentages when limited items run out
  - Normalizes to always total 100%
  - Shows remaining quantity for limited items
  - Prevents opening when all items claimed

âœ“ Pull History
  - Chronological list of all pulls
  - Shows: item name, user name, timestamp, color dot
  - Respects hideContents (user sees their own pulls, others see "Mystery Item")
  - Auto-scrolling list (newest at top)


BOX MARKETPLACE & CATALOG SYSTEM
--------------------------------------------------------------------------------
âœ“ Multi-Source Box Images
  - Default boxes: 3 free permanent box skins (always available)
  - Seasonal boxes: Time-limited Firebase boxes with expiration dates
  - Store boxes: Permanent purchasable Firebase boxes
  - User uploads: Premium users can upload custom boxes to Firebase

âœ“ Tabbed Image Picker
  - "Defaults" tab: Free permanent boxes
  - "Seasonal" tab: Limited-time boxes with countdown badges
  - "Store" tab: Purchasable permanent boxes
  - "My Uploads" tab: User's custom uploaded boxes (premium only)

âœ“ Box Ownership System
  - Default boxes: Free for everyone
  - Purchased boxes: Individually owned by user (stored in userSettings.ownedBoxes)
  - Free users: Can purchase individual box skins
  - Premium users: Can purchase box skins + upload custom boxes

âœ“ Visual Indicators
  - Lock icon on unavailable boxes
  - Price badges on purchasable boxes ($0.99, $1.49, $2.99, etc.)
  - "Owned" badge on purchased boxes
  - "Your Upload" badge on user-uploaded boxes
  - Seasonal badges with labels (Valentine's, Halloween, etc.)

âœ“ Purchase Flow
  - Click locked box â†’ Purchase modal
  - Shows box name, price, description
  - Confirms purchase â†’ Updates Firestore
  - Adds box to user's ownedBoxes array
  - Unlocks box immediately for use


FIREBASE INTEGRATION
--------------------------------------------------------------------------------
âœ“ Firebase SDK Setup
  - Firestore for box catalog and purchases
  - Storage ready for user uploads (requires billing)
  - Auth ready for user management
  - Graceful fallback: works offline without Firebase

âœ“ Box Catalog Service
  - fetchSeasonalBoxes(): Gets active seasonal boxes from Firestore
  - fetchStoreBoxes(): Gets store boxes from Firestore
  - fetchUserUploadedBoxes(): Gets user's uploaded boxes
  - getAllAvailableBoxImages(): Unified loader for all box sources

âœ“ Purchase System
  - purchaseBox(): Records purchase in Firestore
  - Updates user's ownedBoxes in Firestore
  - Syncs with localStorage for offline access

âœ“ Upload System (Premium)
  - uploadUserBox(): Uploads image to Firebase Storage
  - Creates Firestore document for uploaded box
  - Premium-only feature with file size limits


UI/UX DESIGN
--------------------------------------------------------------------------------
âœ“ Royal Blue Color Scheme
  - Dark royal blue (#1e40af) primary
  - Sky blue (#3b82f6) accents
  - Deep space dark backgrounds (#0a0e1a â†’ #1a1f35)
  - Gold accents for premium features
  - Red for danger/delete actions
  - Pink/purple gradients for seasonal items

âœ“ Custom Styling
  - Glass morphism cards with backdrop blur
  - Custom scrollbars with rounded edges and glow on hover
  - No spinner arrows on number inputs
  - Toast notifications (slide up from bottom, 3sec auto-dismiss)
  - Smooth animations (fadeIn, slideUp, spin, pulse, glow)

âœ“ Layout Components
  - Header with notification badge and settings icon
  - Filter tabs (Shared/New/Local)
  - Responsive grid for box cards
  - Two-column layout in box opener (odds + history)
  - Tabbed interface for box marketplace

âœ“ Interactive Elements
  - Hover effects on all buttons and cards
  - Edit/delete buttons on box cards (top-right corner)
  - Color picker with 8 colors, visual selection feedback
  - Loading states and disabled states
  - Upload button for premium users


DATA MANAGEMENT
--------------------------------------------------------------------------------
âœ“ LocalStorage Implementation
  - Key: 'lootBoxes' - array of all boxes
  - Key: 'userSettings' - user preferences + owned boxes
  - Automatic save on create/edit/delete/pull
  - Loads on app mount

âœ“ Firebase/Firestore Collections
  - 'boxCatalog': Seasonal, store, and user-uploaded boxes
  - 'purchases': Purchase transaction records
  - 'users': User data (ownedBoxes, uploadedBoxes)

âœ“ Hybrid Storage Strategy
  - Local boxes: localStorage only (offline-first)
  - User settings: localStorage + Firestore sync
  - Box catalog: Firebase with local caching
  - Graceful degradation if Firebase unavailable

âœ“ Free Tier Limits
  - Max 5 local boxes
  - 3 default box skins (free)
  - Can purchase additional box skins individually
  - Cannot upload custom boxes
  - Cannot create shared boxes

âœ“ Premium Tier Benefits
  - Unlimited local boxes
  - Unlimited shared boxes
  - Can upload custom box skins to Firebase
  - Can purchase box skins (same as free users)
  - Premium badge in header


MONETIZATION MODEL
--------------------------------------------------------------------------------
âœ“ Box Skin Purchases (All Users)
  - Free users: Can buy individual skins ($0.99 - $2.99)
  - Premium users: Can also buy individual skins
  - Purchased skins: Owned forever, usable on unlimited boxes
  - Seasonal skins: Limited-time availability
  - Store skins: Always available

âœ“ Premium Subscription Features
  - Unlimited local boxes (vs 5 for free)
  - Upload custom box skins
  - Create shared boxes
  - Future: Analytics, priority support, etc.

âœ“ Revenue Streams
  1. Individual box skin purchases ($0.99 - $2.99 each)
  2. Premium subscription (TBD pricing)
  3. Future: Seasonal battle pass, exclusive content packs


================================================================================
NOT YET IMPLEMENTED
================================================================================

HIGH PRIORITY
--------------------------------------------------------------------------------
â˜ User Authentication
  - Login/signup flow (Firebase Auth)
  - Display name management
  - Premium tier verification
  - Account settings page
  - Sign out functionality

â˜ Payment Integration
  - Stripe/payment provider integration
  - Purchase confirmation emails
  - Receipt generation
  - Refund handling

â˜ Real Box Images
  - Replace placeholder URLs with actual images
  - Upload seasonal/store box images to Firebase Storage
  - Create premium box image library
  - Design unique seasonal boxes

â˜ Notification System
  - Activity feed panel
  - New pull notifications
  - Seasonal box expiration warnings
  - Purchase confirmations
  - Badge count on header icon


MEDIUM PRIORITY
--------------------------------------------------------------------------------
â˜ Settings Page
  - Theme toggle (dark/light mode options)
  - Display name input
  - Sound effects toggle
  - Email notification preferences
  - Account management (tier info, purchases)

â˜ Seasonal Box Management
  - Countdown timers on seasonal boxes
  - Color-coded by time remaining (green > 7d, yellow < 7d, red < 24h)
  - "NEW" badge for recent additions
  - Auto-hide expired boxes
  - Email notifications before expiration

â˜ User Upload Management
  - View all uploaded boxes
  - Delete uploaded boxes
  - Edit box metadata
  - Set privacy (public/private)
  - Usage statistics

â˜ Share URL Generation
  - Integration with URL shortener API (TinyURL, Bitly, etc.)
  - Copy to clipboard functionality
  - QR code generation
  - Share via social media

â˜ Sound Effects
  - Opening sound (whoosh/reveal)
  - Pull success sound
  - Purchase sound
  - Button click sounds
  - Volume control in settings

â˜ Analytics Dashboard (Paid Feature)
  - Who opened boxes
  - Pull statistics
  - Most popular items
  - Time-based charts
  - Revenue tracking


NICE TO HAVE
--------------------------------------------------------------------------------
â˜ Box Templates
  - Pre-made boxes users can customize
  - Categories (gaming, raffle, giveaway)
  - One-click copy and edit
  - Community-shared templates

â˜ Advanced Marketplace Features
  - Search/filter boxes by category
  - Sort by: newest, price, popularity
  - Preview box contents before purchase
  - User reviews/ratings
  - Featured/promoted boxes

â˜ Social Features
  - Follow other users
  - Like/favorite boxes
  - Comment on boxes
  - Leaderboards
  - Achievement system

â˜ Expiration Management
  - Auto-delete expired boxes
  - Extension functionality
  - Email/notification before expiration

â˜ Export/Import Feature
  - Export boxes to JSON file
  - Import from JSON
  - Backup to cloud
  - Restore from backup

â˜ Progressive Web App (PWA)
  - Installable on home screen
  - Offline functionality
  - Push notifications
  - App-like experience


================================================================================
CURRENT ARCHITECTURE
================================================================================

FILE STRUCTURE
--------------------------------------------------------------------------------
Main App: loot-box-app-v2.html (single file with Firebase)
Helper: add-sample-boxes.html (Firebase data seeder)
Assets: /assets/images/boxes/free/ (3 default box images)
        /assets/images/boxes/premium/ (legacy premium images)

Contents of loot-box-app-v2.html:
  1. HTML Head
     - React CDN imports (react, react-dom, babel)
     - Firebase SDK (app, firestore, storage, auth)
     - Google Fonts (Inter)
     - Global CSS styles

  2. CSS Section
     - Root variables (colors, spacing, fonts)
     - Custom scrollbars
     - Animation keyframes
     - Responsive breakpoints
     - Number input spinner removal

  3. React Components (inline via Babel)
     - Firebase Configuration & Initialization
     - Box Source Types & Catalog
     - Firebase Service Layer (fetch, upload, purchase)
     - Utility Functions
     - Common Components (Button, Input, Card, Toast)
     - Layout Components (Header, FilterTabs, ConfirmDialog)
     - Box Components (BoxCard, BoxCreator, BoxOpener)
     - Item Components (ItemCreator, ItemList)
     - ImagePicker Component (enhanced with tabs)
     - Main App Component

  4. Render
     - ReactDOM.render(<App />, document.getElementById('root'))


COMPONENT HIERARCHY
--------------------------------------------------------------------------------
App (main state management)
â”œâ”€â”€ Header
â”‚   â”œâ”€â”€ Title (gradient text)
â”‚   â”œâ”€â”€ Tier Badge (Free/Premium)
â”‚   â”œâ”€â”€ Notification Button (with badge count)
â”‚   â””â”€â”€ Settings Button
â”‚
â”œâ”€â”€ Home Mode
â”‚   â”œâ”€â”€ FilterTabs (Shared/New/Local)
â”‚   â”œâ”€â”€ Create Button
â”‚   â””â”€â”€ BoxCard Grid
â”‚       â””â”€â”€ BoxCard (multiple)
â”‚           â”œâ”€â”€ Box Image Preview
â”‚           â”œâ”€â”€ Edit Button
â”‚           â”œâ”€â”€ Delete Button (triggers ConfirmDialog)
â”‚           â””â”€â”€ ConfirmDialog (portal-style)
â”‚
â”œâ”€â”€ Create/Edit Mode
â”‚   â””â”€â”€ BoxCreator
â”‚       â”œâ”€â”€ Box Settings (name, type, maxPulls, hide options)
â”‚       â”œâ”€â”€ ImagePicker (NEW - tabbed interface)
â”‚       â”‚   â”œâ”€â”€ Tab Navigation (Defaults/Seasonal/Store/Uploads)
â”‚       â”‚   â”œâ”€â”€ Upload Button (premium users)
â”‚       â”‚   â”œâ”€â”€ Box Grid (with lock icons, price badges)
â”‚       â”‚   â””â”€â”€ Purchase Modal
â”‚       â”œâ”€â”€ ItemCreator
â”‚       â”‚   â”œâ”€â”€ Item form
â”‚       â”‚   â”œâ”€â”€ Remaining percentage display
â”‚       â”‚   â””â”€â”€ Color picker
â”‚       â””â”€â”€ ItemList
â”‚           â””â”€â”€ Item cards with edit/delete
â”‚
â”œâ”€â”€ Open Mode
â”‚   â””â”€â”€ BoxOpener
â”‚       â”œâ”€â”€ Header (back button, name, pulls remaining)
â”‚       â”œâ”€â”€ Opening Animation Area
â”‚       â”‚   â”œâ”€â”€ Ready state (box image from catalog)
â”‚       â”‚   â”œâ”€â”€ Opening state (spinning animation)
â”‚       â”‚   â””â”€â”€ Result state (item reveal with glow)
â”‚       â”œâ”€â”€ Open Button
â”‚       â”œâ”€â”€ Current Odds Panel (if not hidden)
â”‚       â””â”€â”€ Pull History Panel
â”‚
â””â”€â”€ ToastContainer (notifications)


FIREBASE SERVICE LAYER
--------------------------------------------------------------------------------
fetchSeasonalBoxes()
  - Queries Firestore: collection('boxCatalog').where('source', '==', 'seasonal')
  - Filters expired boxes client-side
  - Returns active seasonal boxes

fetchStoreBoxes()
  - Queries Firestore: collection('boxCatalog').where('source', '==', 'store')
  - Returns all active store boxes

fetchUserUploadedBoxes(userId)
  - Queries Firestore: where('source', '==', 'user').where('userId', '==', userId)
  - Returns user's uploaded boxes (premium only)

uploadUserBox(imageFile, metadata, userId)
  - Uploads image to Firebase Storage
  - Creates Firestore document in boxCatalog
  - Returns uploaded box data
  - Premium feature only

purchaseBox(boxId, userId)
  - Records purchase in Firestore purchases collection
  - Updates user's ownedBoxes array in Firestore
  - Returns success/failure

getAllAvailableBoxImages(userSettings)
  - Fetches all box sources in parallel
  - Returns: { defaults, seasonal, store, userUploaded, all }
  - Used by ImagePicker component

userOwnsBox(boxId, userSettings)
  - Checks if user owns/can use a specific box
  - Default boxes: always true
  - Checks ownedBoxes and uploadedBoxes arrays
  - Returns boolean


UTILITY FUNCTIONS
--------------------------------------------------------------------------------
calculateDynamicOdds(items, pullHistory)
  - Filters out fully-claimed items
  - Recalculates percentages to total 100%
  - Returns adjusted odds with remaining counts

validatePercentages(items)
  - Sums all item percentages
  - Returns {valid, total, message}
  - Used to enable/disable create button

getRemainingPercentage(items)
  - Calculates 100 - sum of current items
  - Used in real-time as items are added

generateShareCode()
  - Creates 6-character alphanumeric code
  - Used for box sharing

getBoxImageUrl(imageId, boxCatalog)
  - Returns image URL for a box
  - Supports both local paths and Firebase URLs
  - Handles catalog lookup

canUseBoxImage(imageId, userSettings)
  - Alias for userOwnsBox()
  - Backward compatibility

localStorage helpers:
  - getAllBoxes()
  - saveBox(box)
  - deleteBox(boxId)
  - getBoxById(boxId)
  - getUserSettings()
  - canCreateLocalBox()


================================================================================
DESIGN SYSTEM
================================================================================

COLOR PALETTE
--------------------------------------------------------------------------------
Backgrounds:
  --color-bg-primary: #0a0e1a (darkest)
  --color-bg-secondary: #0f1624 (dark)
  --color-bg-tertiary: #1a1f35 (medium)
  --color-bg-card: rgba(26, 31, 53, 0.6) (glass)

Brand Colors:
  --color-brand-primary: #1e40af (dark royal blue)
  --color-brand-secondary: #2563eb (royal blue)
  --color-brand-accent: #3b82f6 (sky blue)

Text Colors:
  --color-text-primary: #e2e8f0 (bright)
  --color-text-secondary: #cbd5e1 (medium)
  --color-text-tertiary: #94a3b8 (muted)

Semantic Colors:
  Success: #10b981 (green)
  Warning: #f59e0b (gold/amber)
  Error: #ef4444 (red)
  Info: #3b82f6 (blue)
  Seasonal: #ec4899 (pink), #8b5cf6 (purple)

Gradients:
  Primary Button: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%)
  Secondary Button: linear-gradient(135deg, #2563eb 0%, #60a5fa 100%)
  Open Button: linear-gradient(135deg, #1e40af 0%, #f59e0b 100%)
  Header Title: linear-gradient(135deg, #3b82f6 0%, #60a5fa 50%, #93c5fd 100%)
  Premium Badge: linear-gradient(135deg, #f59e0b 0%, #ec4899 100%)
  Seasonal Badge: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%)
  Store Price: linear-gradient(135deg, #f59e0b 0%, #3b82f6 100%)


TYPOGRAPHY
--------------------------------------------------------------------------------
Font Family: 'Inter', sans-serif (from Google Fonts)
Font Weights: 400 (normal), 500 (medium), 600 (semibold), 700 (bold)

Font Sizes:
  xs: 0.625rem (10px) - badges
  sm: 0.75rem (12px) - metadata
  base: 0.875rem (14px) - body text
  md: 1rem (16px) - inputs
  lg: 1.125rem (18px) - buttons
  xl: 1.25rem (20px) - headings
  2xl: 1.5rem (24px) - section titles
  3xl: 2rem (32px) - page titles
  4xl: 2.5rem (40px) - main header


SPACING & LAYOUT
--------------------------------------------------------------------------------
Border Radius:
  sm: 6px
  md: 8px (standard)
  lg: 12px (cards, buttons)
  xl: 16px (large cards)

Spacing:
  xs: 0.25rem (4px)
  sm: 0.5rem (8px)
  md: 0.75rem (12px)
  lg: 1rem (16px)
  xl: 1.5rem (24px)
  2xl: 2rem (32px)

Transitions:
  fast: 0.15s ease
  normal: 0.25s ease (standard)
  slow: 0.4s ease


ANIMATIONS
--------------------------------------------------------------------------------
fadeIn: opacity 0â†’1, translateY 10pxâ†’0, 0.4s
slideUp: opacity 0â†’1, translateY 20pxâ†’0, 0.4s
spin: rotate 0degâ†’360deg, 2s linear infinite
pulse: opacity 1â†’0.5â†’1, 2s infinite
glow: boxShadow intensity variation, 2s infinite


================================================================================
DATA STRUCTURES
================================================================================

BOX OBJECT
--------------------------------------------------------------------------------
{
  id: string,                    // Unique identifier (timestamp)
  name: string,                  // Display name
  type: 'local' | 'shared',      // Box type
  items: Array<Item>,            // Array of item objects
  maxPulls: number | null,       // Pull limit (null = unlimited)
  hideContents: boolean,         // Hide item names in odds/history
  hideOdds: boolean,             // Hide entire odds panel
  pullHistory: Array<Pull>,      // Array of pull records
  createdAt: number,             // Unix timestamp
  shareCode: string,             // 6-char code for sharing
  boxImageId: string,            // Reference to box image (NEW)
  expiresAt?: number             // Unix timestamp (for shared boxes)
}


ITEM OBJECT
--------------------------------------------------------------------------------
{
  id: string,                    // Unique identifier
  name: string,                  // Display name
  percentage: number,            // Probability (0-100)
  color: string,                 // Hex color code
  maxQuantity: number | null     // Max pulls (null = unlimited)
}


PULL OBJECT
--------------------------------------------------------------------------------
{
  itemId: string,                // Reference to item
  itemName: string,              // Item name (for history)
  percentage: number,            // Original percentage
  color: string,                 // Item color
  timestamp: number,             // Unix timestamp
  userName: string               // Display name of puller
}


USER SETTINGS OBJECT
--------------------------------------------------------------------------------
{
  tier: 'free' | 'paid',         // User tier
  localBoxCount: number,         // Current count (for limit checking)
  displayName: string,           // Display name
  soundEnabled: boolean,         // Sound preference
  theme: 'dark',                 // Theme preference (light not implemented)
  uid: string | null,            // Firebase user ID (NEW)
  ownedBoxes: Array<string>,     // Purchased box IDs (NEW)
  uploadedBoxes: Array<string>,  // User-uploaded box IDs (NEW)
  purchasedBoxImages: Array      // Legacy, kept for compatibility
}


BOX IMAGE OBJECT (NEW)
--------------------------------------------------------------------------------
{
  id: string,                    // Unique identifier
  name: string,                  // Display name
  source: string,                // 'default' | 'seasonal' | 'store' | 'user'
  imageUrl: string,              // Full URL or relative path
  price: number | null,          // Price in USD (null = free)
  seasonalInfo: {                // For seasonal boxes only
    label: string,               // "Valentine's", "Halloween", etc.
    startDate: number,           // Unix timestamp
    endDate: number              // Unix timestamp
  } | null,
  active: boolean,               // Whether box is available
  createdAt: number,             // Unix timestamp
  userId?: string,               // For user-uploaded boxes
  file?: string                  // Legacy file path (defaults only)
}


BOX SOURCES (ENUM)
--------------------------------------------------------------------------------
{
  DEFAULT: 'default',            // Hardcoded, always available
  SEASONAL: 'seasonal',          // Time-limited from Firebase
  STORE: 'store',                // Purchasable from Firebase
  USER_UPLOADED: 'user',         // User-created, uploaded to Firebase
  LOCAL: 'local'                 // User-created locally (box type, not image)
}


================================================================================
TECHNICAL NOTES
================================================================================

LOCALSTORAGE KEYS
--------------------------------------------------------------------------------
'lootBoxes'      - Array of all box objects
'userSettings'   - User preferences object + owned/uploaded boxes
'notifications'  - Array of notification objects (not implemented)


FIREBASE COLLECTIONS
--------------------------------------------------------------------------------
'boxCatalog'     - Seasonal, store, and user-uploaded box images
  â””â”€ Document fields: id, name, source, imageUrl, price, seasonalInfo, active, createdAt, userId
'purchases'      - Purchase transaction records
  â””â”€ Document fields: boxId, userId, purchasedAt, type
'users'          - User data (planned for full auth implementation)
  â””â”€ Document fields: ownedBoxes, uploadedBoxes, tier, displayName


FIREBASE CONFIGURATION
--------------------------------------------------------------------------------
Project: lootbox-app-dd5fa
Firestore: Enabled (Native mode, test mode for 30 days)
Storage: Not yet enabled (requires billing for uploads)
Auth: Not yet enabled

Current Status:
âœ“ Firebase initialized successfully
âœ“ Firestore queries working
âœ“ Sample data added (2 seasonal, 3 store boxes)
â˜ Storage setup pending (for user uploads)
â˜ Auth setup pending (for user management)


FREE TIER ENFORCEMENT
--------------------------------------------------------------------------------
Limit: 5 local boxes maximum
Check: canCreateLocalBox() function
  - Returns true if tier === 'paid'
  - Returns true if localBoxCount < 5
  - Returns false otherwise
Blocks: Create button and box save action

Box Skin Access:
  - Default boxes: Always free (all users)
  - Purchased boxes: Check ownedBoxes array
  - Uploaded boxes: Check uploadedBoxes array (premium only)
  - Premium users: Can upload, but still purchase skins individually


PERCENTAGE VALIDATION
--------------------------------------------------------------------------------
Real-time validation as items are added:
  1. Sum all item percentages
  2. Round to 2 decimal places
  3. Compare to 100
  4. Show error if !== 100
  5. Disable create button if invalid

Display shows:
  - "Perfect!" if exactly 100%
  - "Missing X%" if under 100
  - "Over by X%" if over 100


DYNAMIC ODDS CALCULATION
--------------------------------------------------------------------------------
Triggered: Every time box is opened
Process:
  1. For each item, count pulls from history
  2. Calculate remaining = maxQuantity - pulledCount
  3. Filter out items with remaining = 0
  4. Sum percentages of remaining items
  5. Normalize each to (percentage / total) * 100
  6. Return adjusted odds array

Result: Odds always total 100% with available items only


HIDE CONTENTS LOGIC
--------------------------------------------------------------------------------
In Odds Panel:
  - If hideContents: show "???" instead of item name
  - Color dot and percentage still visible

In Pull History:
  - Current user (who pulled): ALWAYS sees actual item name
  - Other users: see "Mystery Item" if hideContents enabled
  - Determined by comparing pull.userName to current user

Rationale: User should know what THEY got, but not what others got


HIDE ODDS LOGIC
--------------------------------------------------------------------------------
When hideOdds is enabled:
  - Entire odds panel is hidden
  - Pull history takes full width
  - Grid changes from 2 columns to 1 column
  - User must open blind (exciting!)


FIREBASE GRACEFUL DEGRADATION
--------------------------------------------------------------------------------
If Firebase not configured (apiKey === "YOUR_API_KEY"):
  - firebaseEnabled = false
  - All fetch functions return empty arrays
  - App works with default boxes only
  - No errors thrown, seamless fallback

If Firebase configured but offline:
  - Firestore queries fail gracefully
  - Returns cached data or empty arrays
  - Toast notification: "Unable to load seasonal/store boxes"


================================================================================
KNOWN ISSUES & LIMITATIONS
================================================================================

EXPECTED BEHAVIORS
--------------------------------------------------------------------------------
âœ“ LocalStorage clears when downloading new versions
  - This is expected for file-based apps
  - Each downloaded file has its own storage space
  - Resolved with hosted version + Firebase sync

âœ“ Placeholder images for seasonal/store boxes
  - Firebase Storage not enabled (requires billing)
  - Can use external image hosting (Imgur, Cloudinary)
  - Will upload real images when Storage enabled


CURRENT LIMITATIONS
--------------------------------------------------------------------------------
â˜ No user authentication yet
  - Users can't sign in/register
  - UID is null in userSettings
  - Purchase system works but not persisted to user account

â˜ Purchase flow incomplete
  - No payment provider integration (Stripe, etc.)
  - purchaseBox() updates data but no actual payment
  - Ready for Stripe integration

â˜ Storage not enabled
  - User uploads feature exists but can't save images
  - Requires Firebase billing setup
  - Premium users can't upload custom boxes yet

â˜ No real-time sync
  - Changes don't sync across devices
  - Waiting on Firebase Auth + real-time listeners


NEEDS TESTING
--------------------------------------------------------------------------------
â˜ Mobile responsiveness
  - Touch interactions
  - Small screen layouts
  - Virtual keyboard behavior

â˜ Cross-browser compatibility
  - Chrome (primary development)
  - Firefox
  - Safari
  - Edge

â˜ Performance with many boxes
  - 50+ boxes in catalog
  - 100+ pulls per box
  - Large pull histories
  - Firestore query optimization


================================================================================
NEXT SESSION PRIORITIES
================================================================================

IMMEDIATE (Session Start)
--------------------------------------------------------------------------------
1. Test Firebase integration
   âœ“ Verify seasonal boxes load
   âœ“ Verify store boxes load
   âœ“ Test purchase flow (updates ownedBoxes)
   â˜ Check offline fallback behavior

2. Add real images
   â˜ Upload seasonal/store box images to image host
   â˜ Update Firestore with real image URLs
   â˜ Test image loading and caching

3. User authentication
   â˜ Enable Firebase Auth
   â˜ Add login/signup UI
   â˜ Connect UID to purchases
   â˜ Sync userSettings with Firestore


RECOMMENDED NEXT STEPS
--------------------------------------------------------------------------------
Priority 1: User Authentication + Real Purchases
  Why: Enables actual monetization and user accounts
  Tasks:
    - Enable Firebase Authentication
    - Build login/signup flow
    - Integrate Stripe for payments
    - Connect purchases to user accounts
    - Add purchase confirmation emails
  Impact: HIGH - enables revenue generation

Priority 2: Real Box Images
  Why: Makes marketplace visually appealing and professional
  Tasks:
    - Design/source 10-15 seasonal box images
    - Design/source 10-15 store box images
    - Upload to Firebase Storage or external host
    - Update Firestore catalog with real URLs
    - Add loading states and image fallbacks
  Impact: HIGH - improves user experience

Priority 3: Firebase Storage for User Uploads
  Why: Enables premium upload feature (revenue stream)
  Tasks:
    - Set up Firebase billing
    - Enable Storage
    - Update upload flow to use Storage
    - Add file size limits and validation
    - Add image preview before upload
  Impact: MEDIUM - completes premium feature

Priority 4: Mobile Optimization
  Why: Primary platform is mobile
  Tasks:
    - Test on various screen sizes
    - Optimize touch interactions
    - Add pull-to-refresh
    - Test virtual keyboard behavior
    - Add PWA manifest for installability
  Impact: HIGH - mobile is primary platform

Priority 5: Settings Page + Notifications
  Why: Improves user experience and retention
  Tasks:
    - Create settings modal/page
    - Add display name management
    - Add notification preferences
    - Build notification system
    - Add activity feed
  Impact: MEDIUM - improves engagement


================================================================================
DEVELOPMENT NOTES
================================================================================

CURRENT DEPLOYMENT
--------------------------------------------------------------------------------
Local Development Server:
  python -m http.server 8000
  Access: http://localhost:8000/loot-box-app-v2.html

Firebase Setup Helper:
  Access: http://localhost:8000/add-sample-boxes.html
  Purpose: Seed Firestore with sample box data

Production Deployment (Future):
  - Deploy to Firebase Hosting
  - Enable HTTPS
  - Custom domain
  - CDN caching


PROS OF CURRENT APPROACH (Single HTML File + Firebase)
--------------------------------------------------------------------------------
âœ“ Easy to deploy - minimal setup
âœ“ No build process required initially
âœ“ Firebase provides scalable backend
âœ“ Works offline with local boxes
âœ“ Easy to share and test
âœ“ Marketplace ready for mobile deployment


CONS OF CURRENT APPROACH
--------------------------------------------------------------------------------
âœ— Large file size (~3000+ lines now)
âœ— Hard to maintain as features grow
âœ— No code splitting
âœ— No hot module reloading
âœ— Limited TypeScript support


WHEN TO REFACTOR TO MODULAR STRUCTURE
--------------------------------------------------------------------------------
Consider splitting into modules when:
  - Adding user authentication (separate auth flow)
  - Building admin panel (separate app)
  - Team collaboration increases
  - Need build optimization for mobile
  - Want TypeScript support
  - Adding complex state management (Redux, etc.)


SUGGESTED FUTURE STRUCTURE (Mobile App)
--------------------------------------------------------------------------------
src/
â”œâ”€â”€ index.html
â”œâ”€â”€ firebase/
â”‚   â”œâ”€â”€ config.js
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ firestore.js
â”‚   â””â”€â”€ storage.js
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”œâ”€â”€ Button.jsx
â”‚   â”‚   â”œâ”€â”€ Input.jsx
â”‚   â”‚   â”œâ”€â”€ Card.jsx
â”‚   â”‚   â””â”€â”€ Toast.jsx
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”œâ”€â”€ Header.jsx
â”‚   â”‚   â”œâ”€â”€ FilterTabs.jsx
â”‚   â”‚   â”œâ”€â”€ ConfirmDialog.jsx
â”‚   â”‚   â””â”€â”€ BottomNav.jsx
â”‚   â”œâ”€â”€ boxes/
â”‚   â”‚   â”œâ”€â”€ BoxCard.jsx
â”‚   â”‚   â”œâ”€â”€ BoxCreator.jsx
â”‚   â”‚   â”œâ”€â”€ BoxOpener.jsx
â”‚   â”‚   â”œâ”€â”€ ItemCreator.jsx
â”‚   â”‚   â”œâ”€â”€ ItemList.jsx
â”‚   â”‚   â””â”€â”€ ImagePicker.jsx
â”‚   â”œâ”€â”€ marketplace/
â”‚   â”‚   â”œâ”€â”€ MarketplaceHome.jsx
â”‚   â”‚   â”œâ”€â”€ SeasonalBoxes.jsx
â”‚   â”‚   â”œâ”€â”€ StoreBoxes.jsx
â”‚   â”‚   â””â”€â”€ PurchaseModal.jsx
â”‚   â””â”€â”€ auth/
â”‚       â”œâ”€â”€ Login.jsx
â”‚       â”œâ”€â”€ Signup.jsx
â”‚       â””â”€â”€ Profile.jsx
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ boxCatalog.js
â”‚   â”œâ”€â”€ purchases.js
â”‚   â””â”€â”€ uploads.js
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ calculations.js
â”‚   â”œâ”€â”€ storage.js
â”‚   â””â”€â”€ validation.js
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ images/
â”œâ”€â”€ styles/
â”‚   â””â”€â”€ global.css
â””â”€â”€ App.jsx


================================================================================
FIREBASE SETUP INSTRUCTIONS
================================================================================

QUICK START (Already Completed)
--------------------------------------------------------------------------------
âœ“ Firebase project created: lootbox-app-dd5fa
âœ“ Firestore enabled (Native mode, test mode)
âœ“ Firebase config added to app
âœ“ Sample data added (5 boxes total)
â˜ Storage pending (requires billing)
â˜ Auth pending (next step)


ADDING MORE BOX DATA
--------------------------------------------------------------------------------
1. Open Firebase Console: https://console.firebase.google.com/
2. Select project: lootbox-app-dd5fa
3. Go to: Firestore Database
4. Collection: boxCatalog
5. Add document with fields:
   - id: (custom ID, e.g., "spring2024")
   - name: "Spring Garden Box"
   - source: "seasonal" or "store"
   - imageUrl: "https://your-image-url.com/box.png"
   - price: 1.99 (or null for premium-only)
   - active: true
   - createdAt: (timestamp)
   - seasonalInfo: (if seasonal)
     - label: "Spring"
     - startDate: (timestamp)
     - endDate: (timestamp)


ENABLING AUTHENTICATION (Next Step)
--------------------------------------------------------------------------------
1. Firebase Console â†’ Build â†’ Authentication
2. Click "Get started"
3. Enable sign-in methods:
   - Email/Password
   - Google (optional but recommended)
4. Update app with login/signup UI
5. Connect user data to purchases


ENABLING STORAGE (For User Uploads)
--------------------------------------------------------------------------------
1. Set up billing in Firebase Console
2. Build â†’ Storage â†’ Get started
3. Start in test mode (change rules later)
4. Update security rules for user uploads
5. Test upload functionality


================================================================================
CONTACT & HANDOFF
================================================================================

CURRENT FILES
--------------------------------------------------------------------------------
Main App: loot-box-app-v2.html (~3000 lines)
  Location: /Users/fdimi/Desktop/loot-box-app/
  Size: ~150KB (including Firebase SDK)
  React Version: 18
  Firebase SDK: 10.7.1

Setup Helper: add-sample-boxes.html
  Purpose: Seed Firestore with sample boxes
  One-time use, can delete after setup

Asset Folders:
  /assets/images/boxes/free/ (3 default images)
  /assets/images/boxes/premium/ (2 legacy images)


HOW TO RUN
--------------------------------------------------------------------------------
1. Start local server: python -m http.server 8000
2. Open: http://localhost:8000/loot-box-app-v2.html
3. Create boxes and test marketplace!

Firebase is connected and working!


IMPORTANT REMINDERS
--------------------------------------------------------------------------------
1. Firebase is configured and working
2. Default boxes work offline
3. Seasonal/store boxes load from Firebase
4. Purchase flow ready (needs payment integration)
5. Storage not enabled yet (user uploads pending)
6. Auth not enabled yet (anonymous usage only)
7. Test mode expires in 30 days (update Firestore rules)


TESTING CHECKLIST
--------------------------------------------------------------------------------
âœ“ Create a box with default image
âœ“ Check "Seasonal" tab for Valentine's/Halloween boxes
âœ“ Check "Store" tab for purchasable boxes
âœ“ Click locked box â†’ see purchase modal
âœ“ Verify price badges show correctly
âœ“ Test offline mode (disable internet, reload)
âœ“ Verify default boxes still work offline
â˜ Add real images to Firebase
â˜ Test user authentication
â˜ Integrate payment provider
â˜ Test on mobile devices


================================================================================
END OF SUMMARY
================================================================================

The loot box app now has a full marketplace system with Firebase integration!
Next steps: Add authentication, integrate payments, and deploy to mobile.

Ready for monetization and scaling! ğŸš€
