====================================================================
ADD MAX PULLS PER PERSON FEATURE - CLAUDE CODE INSTRUCTIONS
====================================================================

CONTEXT:
- Currently boxes have a "maxPulls" field that limits TOTAL pulls
  for the entire box across all users
- We want to add a "maxPullsPerUser" field that gives each
  individual user their own pull limit
- These two limits are independent â€” creator can use either,
  both, or neither
- Pull history already stores userName on each pull, so we can
  count per-user pulls without any data model changes beyond
  adding the new field

====================================================================
CHANGES NEEDED IN index.html
====================================================================

--------------------------------------------------------------------
CHANGE 1: ADD STATE FOR maxPullsPerUser IN BoxCreator
--------------------------------------------------------------------

In the BoxCreator component, find the existing maxPulls state:

      const [maxPulls, setMaxPulls] = useState(editingBox && editingBox.maxPulls ? editingBox.maxPulls.toString() : '');

Add a new state line right after it:

      const [maxPullsPerUser, setMaxPullsPerUser] = useState(editingBox && editingBox.maxPullsPerUser ? editingBox.maxPullsPerUser.toString() : '');

--------------------------------------------------------------------
CHANGE 2: ADD maxPullsPerUser TO THE BOX DATA IN handleCreate
--------------------------------------------------------------------

In the BoxCreator component, find the boxData object in
handleCreate. It looks like:

        const boxData = {
          id: editingBox ? editingBox.id : Date.now().toString(),
          name: boxName.trim(),
          items,
          maxPulls: maxPulls ? parseInt(maxPulls) : null,
          type: boxType,
          shareCode: editingBox ? editingBox.shareCode : generateShareCode(),
          pullHistory: editingBox ? editingBox.pullHistory : [],
          createdAt: editingBox ? editingBox.createdAt : Date.now(),
          boxImageId: boxImageId,
          hideContents: hideContents,
          hideOdds: hideOdds,
        };

Add maxPullsPerUser to it, right after the maxPulls line:

          maxPullsPerUser: maxPullsPerUser ? parseInt(maxPullsPerUser) : null,

--------------------------------------------------------------------
CHANGE 3: ADD maxPullsPerUser TO THE LOCAL REF FOR SHARED BOXES
--------------------------------------------------------------------

In BoxCreator's handleCreate, find the localRef object that gets
saved for shared boxes. It looks like:

            const localRef = {
              id: boxData.id,
              name: boxData.name,
              type: 'shared',
              shareCode: boxData.shareCode,
              isSharedRef: true,
              items: boxData.items,
              maxPulls: boxData.maxPulls,
              pullHistory: [],
              createdAt: boxData.createdAt,
              boxImageId: boxData.boxImageId,
              hideContents: boxData.hideContents,
              hideOdds: boxData.hideOdds,
            };

Add this line right after maxPulls:

              maxPullsPerUser: boxData.maxPullsPerUser,

--------------------------------------------------------------------
CHANGE 4: ADD THE INPUT FIELD IN BoxCreator UI
--------------------------------------------------------------------

In the BoxCreator component's JSX, find the existing Max Pulls
input. It looks like:

              <div style={{ marginTop: '1rem', maxWidth: '250px' }}>
                <Input
                  type="number"
                  label="Max Pulls (Optional)"
                  placeholder="Unlimited"
                  value={maxPulls}
                  onChange={(e) => setMaxPulls(e.target.value)}
                  min="1"
                  fullWidth
                />
              </div>

Replace that entire div with a two-column layout:

              <div style={{ marginTop: '1rem', display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '1rem', maxWidth: '500px' }}>
                <Input
                  type="number"
                  label="Max Pulls Total (Optional)"
                  placeholder="Unlimited"
                  value={maxPulls}
                  onChange={(e) => setMaxPulls(e.target.value)}
                  min="1"
                  fullWidth
                />
                <Input
                  type="number"
                  label="Max Pulls Per Person (Optional)"
                  placeholder="Unlimited"
                  value={maxPullsPerUser}
                  onChange={(e) => setMaxPullsPerUser(e.target.value)}
                  min="1"
                  fullWidth
                />
              </div>

--------------------------------------------------------------------
CHANGE 5: ENFORCE PER-USER LIMIT IN BoxOpener
--------------------------------------------------------------------

In the BoxOpener component, find these existing lines near the
top of the component (after the state declarations):

      const remainingPulls = box.maxPulls ? box.maxPulls - pullHistory.length : null;
      const canPull = !box.maxPulls || pullHistory.length < box.maxPulls;

Replace them with:

      const remainingPulls = box.maxPulls ? box.maxPulls - pullHistory.length : null;

      // Calculate per-user remaining pulls
      const currentUserName = userName || 'You';
      const userPullCount = pullHistory.filter(p => p.userName === currentUserName).length;
      const remainingUserPulls = box.maxPullsPerUser ? box.maxPullsPerUser - userPullCount : null;

      // Can pull only if BOTH limits allow it
      const totalLimitOk = !box.maxPulls || pullHistory.length < box.maxPulls;
      const userLimitOk = !box.maxPullsPerUser || userPullCount < box.maxPullsPerUser;
      const canPull = totalLimitOk && userLimitOk;

--------------------------------------------------------------------
CHANGE 6: SHOW PER-USER PULL COUNT IN BoxOpener HEADER
--------------------------------------------------------------------

In the BoxOpener component's JSX, find the section that displays
remaining pulls. It's near the top header area and looks like:

            {remainingPulls !== null && (
              <div style={{
                padding: '0.5rem 1rem',
                background: remainingPulls === 0 ? 'rgba(239, 68, 68, 0.2)' : 'rgba(59, 130, 246, 0.2)',
                border: `1px solid ${remainingPulls === 0 ? '#ef4444' : '#3b82f6'}`,
                borderRadius: '8px',
                fontSize: '0.875rem',
                fontWeight: 600,
                color: remainingPulls === 0 ? '#fca5a5' : '#93c5fd',
              }}>
                {remainingPulls} Pulls Left
              </div>
            )}

Replace it with:

            <div style={{ display: 'flex', gap: '0.5rem', flexWrap: 'wrap' }}>
              {remainingPulls !== null && (
                <div style={{
                  padding: '0.5rem 1rem',
                  background: remainingPulls === 0 ? 'rgba(239, 68, 68, 0.2)' : 'rgba(59, 130, 246, 0.2)',
                  border: `1px solid ${remainingPulls === 0 ? '#ef4444' : '#3b82f6'}`,
                  borderRadius: '8px',
                  fontSize: '0.875rem',
                  fontWeight: 600,
                  color: remainingPulls === 0 ? '#fca5a5' : '#93c5fd',
                }}>
                  {remainingPulls} Total Left
                </div>
              )}
              {remainingUserPulls !== null && (
                <div style={{
                  padding: '0.5rem 1rem',
                  background: remainingUserPulls === 0 ? 'rgba(239, 68, 68, 0.2)' : 'rgba(139, 92, 246, 0.2)',
                  border: `1px solid ${remainingUserPulls === 0 ? '#ef4444' : '#8b5cf6'}`,
                  borderRadius: '8px',
                  fontSize: '0.875rem',
                  fontWeight: 600,
                  color: remainingUserPulls === 0 ? '#fca5a5' : '#c4b5fd',
                }}>
                  You: {remainingUserPulls} Left
                </div>
              )}
            </div>

--------------------------------------------------------------------
CHANGE 7: UPDATE ERROR MESSAGES IN handleOpen
--------------------------------------------------------------------

In the BoxOpener component, find the handleOpen function. Near
the top it has:

        if (!canPull) {
          error('No pulls remaining!');
          return;
        }

Replace with:

        if (!canPull) {
          if (!userLimitOk) {
            error('You have used all your pulls!');
          } else {
            error('No pulls remaining!');
          }
          return;
        }

--------------------------------------------------------------------
CHANGE 8: INCLUDE maxPullsPerUser IN VISITOR REF
--------------------------------------------------------------------

In the App component, find the loadSharedBox function. Inside it
there is a visitorRef object:

            const visitorRef = {
              id: box.id,
              name: box.name,
              type: 'shared',
              shareCode: box.shareCode,
              isSharedRef: true,
              isVisitor: true,
              items: box.items,
              maxPulls: box.maxPulls,
              pullHistory: [],
              createdAt: box.createdAt,
              boxImageId: box.boxImageId,
              hideContents: box.hideContents,
              hideOdds: box.hideOdds,
            };

Add this line right after maxPulls:

              maxPullsPerUser: box.maxPullsPerUser || null,

====================================================================
SUMMARY OF ALL CHANGES
====================================================================

1. BoxCreator: Add maxPullsPerUser state
2. BoxCreator: Add maxPullsPerUser to boxData in handleCreate
3. BoxCreator: Add maxPullsPerUser to localRef for shared boxes
4. BoxCreator: Add per-person input field next to total pulls
5. BoxOpener: Calculate per-user pull count and enforce limit
6. BoxOpener: Show per-user remaining pulls badge in header
7. BoxOpener: Specific error message when user limit reached
8. App: Include maxPullsPerUser in visitor ref

FILES CHANGED: Only index.html
